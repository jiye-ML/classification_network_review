* [paper](paper/60.005-17-Deformable-Convolutional-Networks.pdf)
* [可变形卷积网络：计算机新“视”界](https://mp.weixin.qq.com/s?__biz=MzAwMTA3MzM4Nw==&mid=2649441063&idx=1&sn=e1ab65e2c20af1f4bff2100893f48cbe&chksm=82c0aaa3b5b723b58cf65527be4028e63a2bfb79859c83f42e244987285f4ff3ca5ff6779285#rd)

#### 动机

* 由于同样的物体在图像中可能呈现出不同的大小、姿态、视角变化甚至非刚体形变，因此**如何适应这些复杂的几何形变是物体识别的主要难点**，同时也是计算机视觉领域多年来关注的核心问题。很多传统经典方法，如尺度不变的特征变换（scale invariant feature transform, or SIFT）和可变形部件模型（deformable part models）等，都旨在解决这一问题。然而，由于人工设计特征的局限性，传统视觉方法在物体识别问题上多年来并未取得突破性的进展。
* 卷积神经网络的成功和局限:
  * 近年来，随着深度卷积神经网络的普遍使用，很多困难的视觉问题都获得了重大突破。图像识别于两年多前首次超越了人类的识别能力。物体检测、图像分割等也都达到了几年前传统方法难以企及的高度。
  * 由于强大的建模能力和自动的端到端的学习方式，深度卷积神经网络可以从大量数据中学习到有效特征，避免了传统方法人工设计特征的弊端。然而，现有的网络模型对于物体几何形变的适应能力几乎完全来自于数据本身所具有的多样性，其模型内部并不具有适应几何形变的机制。究其根本，是因为卷积操作本身具有固定的几何结构，而由其层叠搭建而成的卷积网络的几何结构也是固定的，所以不具有对于几何形变建模的能力。
  * 举个例子，想要识别出同一图像中不同大小的物体（比如远近不同的两个人），理想的结果是，在对应于每个物体的位置网络需要具有相应大小的感受野（receptive field）。直观的说，为了识别更大的物体网络需要看到更大的图像区域。然而，在现有的卷积网络架构中，图像中任何位置的感受野大小都是相同的，其取决于事先设定的网络参数（卷积核的大小、步长和网络深度等），无法根据图像内容自适应调整，从而限制了识别精度。
* **消除网络难以适应几何变形的“罪魁祸首”**:
  * 追根溯源，上述局限来自于卷积网络的基本构成单元，即卷积操作。该操作在输入图像的每个位置时会进行基于规则格点位置的采样，然后对于采样到的图像值做卷积并作为该位置的输出。通过端到端的梯度反向传播学习，系统将会得到一个用矩阵表示的卷积核的权重。这就是自卷积网络诞生之初，已使用二十多年的基本单元结构。

#### 贡献

* deformable convolution  ：在标准卷积的格子采样位置加入2D的偏置；
* deformable RoI pooling.：它为前一个RoI池的常规bin分区中的每个bin位置添加了一个偏移量；

#### 方法

##### 1. deformable convolution

* 微软亚洲研究院的研究员们发现，**标准卷积中的规则格点采样是导致网络难以适应几何形变的“罪魁祸首”**。为了削弱这个限制，研究员们对卷积核中每个采样点的位置都增加了一个偏移的变量。通过这些变量，卷积核就可以在当前位置附近随意的采样，而不再局限于之前的规则格点。这样扩展后的卷积操作被称为可变形卷积（deformable convolution）。

![1541312488287](readme/60.005-卷积图示.png)

* 事实上，可变形卷积单元中增加的偏移量是网络结构的一部分，通过另外一个平行的标准卷积单元计算得到，进而也可以通过梯度反向传播进行端到端的学习。加上该偏移量的学习之后，可变形卷积核的大小和位置可以根据当前需要识别的图像内容进行动态调整，其直观效果就是不同位置的卷积核采样点位置会根据图像内容发生自适应的变化，从而适应不同物体的形状、大小等几何形变，

![1541312676013](readme/60.005-操作过程.png)

* 有两步组成

1. 采样在输入要素图x上使用常规网格R.

![1541319282026](readme/60.005-deformation卷积_02.png)
* 通常卷积一样形式：

  ![1541319393392](readme/60.005-deformation卷积_03.png)

* 在Deformation 卷积中，再加入偏置

![1541319451572](readme/60.005-deformation卷积_04.png)

2. 由w加权的采样值的总和；

![1541319168108](readme/60.005-deformation卷积_01.png)

##### 2. deformable RoI Pooling

#### 优点

* **可变形卷积神经网络：简明深刻的网络结构革新**：
  * 可变形卷积单元具有诸多良好的性质。它不需要任何额外的监督信号，可以直接通过目标任务学习得到。它可以方便地取代任何已有视觉识别任务的卷积神经网络中的若干个标准卷积单元，并通过标准的反向传播进行端到端的训练。由此得到的网络则称为“可变形卷积网络”。
  * 可变形卷积网络是对于传统卷积网络简明而又意义深远的结构革新，具有重要的学术和实践意义。它适用于所有待识别目标具有一定几何形变的任务（几乎所有重要的视觉识别任务都有此特点，人脸、行人、车辆、文字、动物等），可以直接由已有网络结构扩充而来，无需重新预训练。**它仅增加了很少的模型复杂度和计算量，且显著提高了识别精度**。例如，在用于自动驾驶的图像语义分割数据集（CityScapes）上，可变形卷积神经网络将准确率由70%提高到了75%。
  * 此外，通过增加偏移量来学习几何形变的思想还可方便地扩展到其它计算单元中去。例如，目前业界最好的物体检测方法都使用了基于规则块采样的兴趣区域（region of interests, ROI）池化（pooling）。在该操作中，对于每个采样的规则块增加类似的偏移量，从而得到可变形兴趣区域池化 (deformable ROI pooling）。由此所获得的新的物体检测方法也取得了显著的性能提升。
* deformation convolution有能力自适应学习感受野：

![1541335946332](readme/60.005-实验_感受野不同.png)

#### 实验

* 在最后的基层使用deformable convolution:

![1541335599397](readme/60.005-实验_卷积加入时机.png)